sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/UIComponent","jquery.sap.global"],function(e,t,o){"use strict";var a;return e.extend("chobanii.controller.uploadPage",{onInit:function(){},onSubmit2:function(){sap.m.MessageToast.show("navigate Successfully");var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("Exceldata",{},true)},onBackPress:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("RouteView1",{},true)},onLogoutPress:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("RouteView1",{},true);sap.m.MessageToast.show("Logout Successfully")},onInprogress:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("Inprogress",{},true)},onAmount:function(){var e=this.byId("invoiceData").getValue();if(!e){this.byId("invoiceData").setValueState("Error");this.byId("invoiceData").setValueStateText("Amount cannot be empty");return}if(!/^[0-9.]+$/.test(e)){this.byId("invoiceData").setValueState("Error");this.byId("invoiceData").setValueStateText("Amount can only contain numbers and a decimal point");return}var t=parseFloat(e.trim());if(isNaN(t)||t<=0){this.byId("invoiceData").setValueState("Error");this.byId("invoiceData").setValueStateText("Amount should be a positive number");return}this.byId("invoiceData").setValueState("None")},onInvoiceChange:function(){var e=this;var t=this.byId("runid").mProperties.value;const o=/^[A-Za-z0-9]+$/;if(t==""){sap.m.MessageToast.show("Enter Invoice Number")}else if(!o.test(t)){sap.m.MessageToast.show("Invoice Number Can only Contain AlphaNumeric Value");this.oModel.setProperty("/valueStateRunId","Error")}else{var a=this.getView().getModel().sServiceUrl;var s=new sap.ui.model.odata.v2.ODataModel(a);s.create("/getRunId",{data:JSON.stringify(t)},{success:function(t,o){if(o){sap.ui.core.BusyIndicator.hide()}if(o.data.getRunId.Status!=="[]"){sap.m.MessageToast.show("Invoice Number Already Exists");e.oModel.setProperty("/valueStateRunId","Error");console.log(e.oModel);console.log("success")}else{e.oModel.setProperty("/valueStateRunId","None")}console.log("OData service call success")},error:function(e){console.log("OData service call failed",e);sap.m.MessageToast.show("Service Not Reachable")}})}},onUpload:function(e){var t=e.getParameter("files")[0];var o=new FileReader;o.onload=function(e){var t=new Uint8Array(e.target.result);var o=XLSX.read(t,{type:"array"});o.SheetNames.forEach(function(e){var t=o.Sheets[e];var s=XLSX.utils.sheet_to_json(t,{header:1});var n=JSON.stringify(s);a=n})};o.readAsArrayBuffer(t)},onSubmit:function(){var e=this;var t=e.getView().byId("runid").getValue();var o=e.getView().byId("DP3").getValue();var s=e.getView().byId("invoiceData").getValue();var n={invoiceNumber:t,invoiceDate:o,totalAmount:s,excelData:a};console.log("formDataToPass",n);const r=JSON.stringify(n);console.log(typeof r);fetch("https://port4040-workspaces-ws-v479k.us10.trial.applicationstudio.cloud.sap/my/excelUpload",{method:"POST",headers:{"Content-Type":"application/json"},body:r}).then(e=>e.json()).then(e=>{console.log("Response from uploadExcelFile API:",e);const t=JSON.parse(e.response);console.log(t.status);if(t.status==200){sap.m.MessageToast.show("Invoice Uploaded Successfully");var o=sap.ui.core.UIComponent.getRouterFor(this);o.navTo("Exceldata",{},true);this.byId("invoiceData").setValue("");this.byId("DP3").setValue("");this.byId("runid").setValue("");this.byId("fileUploader1").setValue("")}if(t.status==400){sap.m.MessageToast.show("Server Not Responding");var o=sap.ui.core.UIComponent.getRouterFor(this);o.navTo("uploadPage",{},true)}}).catch(e=>{console.error("Failed to upload Excel file:",e)})},onReset:function(){this.byId("invoiceData").setValue("");this.byId("DP3").setValue("");this.byId("runid").setValue("");this.byId("fileUploader1").setValue("")}})});